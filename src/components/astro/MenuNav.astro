---
import { getRoute, isRouteActive } from '@config/routes';
/**
 * MenuNav Component
 *
 * Main navigation menu with active state highlighting and responsive variants.
 *
 * Supports locale-aware routes and determines the active state based on the
 * current path. Renders differently for mobile and desktop layouts.
 *
 * Features:
 * - Active state highlighting for the current page
 * - Locale-aware route generation using translation keys
 * - Exact matching for home and about pages
 * - Prefix matching for blog (supports nested routes like /blog/post-slug)
 * - Responsive layout with mobile (vertical) and desktop (horizontal) variants
 * - Accessible with aria-current="page" for active links
 *
 * Navigation Items:
 * - Home: Links to homepage, exact match on /
 * - About: Links to about page, exact match on /about
 * - Blog: Links to blog index, prefix match for /blog and /blog/*
 *
 * Navigation Matching Strategy:
 * - Locale is domain-based (ambilab.com vs. ambilab.cz), so currentPath
 *   never contains /en/ or /cs/ prefixes
 * - Astro does not add trailing slashes by default to canonical URLs
 * - Blog uses prefix matching to highlight when viewing any blog page
 * - Home and About use exact equality as they have no nested routes
 *
 * Styling:
 * - Active links: solid background with inverted text colors
 * - Inactive links: secondary text color with hover/focus states
 * - Uses semantic color tokens for consistent theming
 * - Optical padding (pb-[4px] pt-[3.5px]) for pixel-perfect alignment
 *
 * @component
 * @example
 * ```astro
 * <!-- Desktop navigation (horizontal) -->
 * <MenuNav locale="en" currentPath="/blog" mobile={false} />
 *
 * <!-- Mobile navigation (vertical) -->
 * <MenuNav locale="en" currentPath="/blog" mobile={true} />
 * ```
 */
import { getTranslation } from '@i18n/translations';
import type { Locale } from '@type/locale';

/**
 * Props for the MenuNav component.
 */
export interface Props {
    /**
     * The locale for navigation labels and route generation.
     *
     * Used to fetch translated navigation labels and generate locale-aware routes.
     */
    locale: Locale;

    /**
     * The current page path used to determine which navigation item is active.
     *
     * Should be the pathname without locale prefix (e.g., '/blog', not '/en/blog').
     * This is because locale detection is domain-based, not path-based.
     */
    currentPath: string;

    /**
     * Whether this is the mobile menu variant.
     *
     * - `true`: Vertical layout with full-width links (for mobile menu)
     * - `false`: Horizontal layout with compact links (for desktop header)
     */
    mobile: boolean;
}

const { locale, currentPath, mobile } = Astro.props as Props;

/** Get translations for the current locale. */
const t = getTranslation(locale);

/**
 * Navigation items configuration with routes, labels, and active states.
 *
 * Each item includes:
 * - `href`: Locale-aware route generated by getRoute()
 * - `label`: Translated label from translations.ts
 * - `isActive`: Active state determined by isRouteActive()
 *
 * The isRouteActive() function uses different matching strategies:
 * - Home & About: Exact match (e.g., currentPath === '/')
 * - Blog: Prefix match (e.g., currentPath starts with '/blog')
 *
 * This allows blog navigation to stay highlighted when viewing individual posts.
 */
const navItems = [
    {
        href: getRoute('home', locale),
        label: t.nav.home,
        isActive: isRouteActive(currentPath, 'home'),
    },
    {
        href: getRoute('about', locale),
        label: t.nav.about,
        isActive: isRouteActive(currentPath, 'about'),
    },
    {
        href: getRoute('blog', locale),
        label: t.nav.blog,
        isActive: isRouteActive(currentPath, 'blog'),
    },
];

/**
 * Gets the CSS classes for a navigation item based on its active state.
 *
 * Active State (isActive = true):
 * - Solid background with text-primary color
 * - Inverted text colors (white on dark bg in light mode, black on light bg in dark mode)
 * - Creates a "button-like" appearance for the active page
 *
 * Inactive State (isActive = false):
 * - No background, secondary text color
 * - Hover/focus: transitions to primary text color
 * - Uses modern CSS nesting syntax [&:hover,&:focus] for state variants
 *
 * All colors use semantic design tokens for consistent theming across light/dark modes.
 *
 * @param isActive - Whether the navigation item is currently active
 * @returns The CSS class string for the navigation item
 */
const getNavItemClasses = (isActive: boolean): string => {
    return isActive
        ? 'font-medium bg-text-primary text-white dark:bg-text-primary-dark dark:text-black'
        : 'font-medium text-text-secondary [&:hover,&:focus]:text-text-primary dark:text-text-secondary-dark dark:[&:hover,&:focus]:text-text-primary-dark';
};
---

{
    mobile ? (
        // Mobile menu: vertical layout with larger text
        <div class="flex flex-col">
            {navItems.map((item) => (
                <a
                    href={item.href}
                    aria-current={item.isActive ? 'page' : undefined}
                    class:list={['px-2 pb-[4px] pt-[3.5px]', getNavItemClasses(item.isActive)]}
                >
                    {item.label}
                </a>
            ))}
        </div>
    ) : (
        // Desktop menu: horizontal layout
        <div class="flex items-center gap-2">
            {navItems.map((item) => (
                <a
                    href={item.href}
                    aria-current={item.isActive ? 'page' : undefined}
                    class:list={['px-2 py-[2.5px]', getNavItemClasses(item.isActive)]}
                >
                    {item.label}
                </a>
            ))}
        </div>
    )
}
