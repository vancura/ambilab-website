---
import '@/styles/global.css';

import CookieBanner from '@components/svelte/CookieBanner.svelte';
import GoToTop from '@components/svelte/GoToTop.svelte';
import type { Locale } from '@type/locale';
import type { ISEOMetadata } from '@type/seo';

import Footer from './Footer.astro';
import Head from './Head.astro';
import Header from './Header.astro';

export interface Props extends ISEOMetadata {
    locale: Locale;
}

const { locale, ...seoProps } = Astro.props;
const currentPath = Astro.url.pathname;
---

<!doctype html>
<html lang={locale} class="scroll-smooth">
    <head>
        <!-- Initialize dark mode immediately to prevent flash -->
        <script is:inline>
            (function () {
                const theme = localStorage.getItem('theme');
                const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                const isDark = theme === 'dark' || (!theme && systemPrefersDark);

                if (isDark) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            })();
        </script>

        <Head {...seoProps} locale={locale} />
    </head>

    <body class="bg-white text-gray-900 dark:bg-gray-900 dark:text-gray-100">
        <Header locale={locale} currentPath={currentPath} />

        <main class="min-h-screen">
            <slot />
        </main>

        <Footer locale={locale} />

        <GoToTop client:idle />

        <CookieBanner client:idle locale={locale} />
    </body>
</html>
