---
import '@/styles/mdx-content.css';

import { getTranslation } from '@i18n/translations';
import { calculateReadingTime } from '@i18n/utils';
import type { Locale } from '@type/locale';
import type { ISEOMetadata } from '@type/seo';
import { formatDate } from '@utils/formatDate';

import HeadingLinks from './HeadingLinks.astro';
import Icon from './Icon.astro';
import PageLayout from './PageLayout.astro';

export interface Props extends ISEOMetadata {
    locale: Locale;
    title: string;
    pubDate: Date;
    updatedDate?: Date;
    author: string;
    tags?: string[];
    content: string;
    translationPath?: string;
}

const {
    locale,
    title,
    description,
    permalink,
    pubDate,
    updatedDate,
    author,
    tags = [],
    content,
    translationPath,
    ...seoProps
} = Astro.props as Props;
const t = getTranslation(locale);
const readingTime = calculateReadingTime(content);
---

<PageLayout
    locale={locale}
    title={title}
    description={description}
    permalink={permalink}
    {...translationPath ? { translationPath } : {}}
    {...seoProps}
>
    <article class="container mx-auto px-4 py-12">
        <header class="mb-12">
            <h1 class="mb-4 text-4xl font-bold md:text-5xl">{title}</h1>

            <div class="text-text-muted dark:text-text-muted-dark flex flex-wrap items-center gap-4 text-sm">
                <div class="flex items-center gap-2">
                    <Icon name="user" class="h-4 w-4" />
                    <span>{author}</span>
                </div>

                <div class="flex items-center gap-2">
                    <Icon name="calendar" class="h-4 w-4" />
                    <time datetime={pubDate.toISOString()}>
                        {t.blog.publishedOn}
                        {formatDate(pubDate, locale)}
                    </time>
                </div>

                {
                    updatedDate && (
                        <div class="flex items-center gap-2">
                            <Icon name="refresh" class="h-4 w-4" />
                            <time datetime={updatedDate.toISOString()}>
                                {t.blog.updatedOn} {formatDate(updatedDate, locale)}
                            </time>
                        </div>
                    )
                }

                <div class="flex items-center gap-2">
                    <Icon name="clock" class="h-4 w-4" />
                    <span>
                        {readingTime}
                        {t.blog.minutesShort}
                    </span>
                </div>
            </div>

            {
                tags.length > 0 && (
                    <div class="mt-4 flex flex-wrap items-center gap-2">
                        <Icon name="tag" class="text-text-muted dark:text-text-muted-dark h-4 w-4" />
                        {tags.map((tag) => (
                            <span class="bg-tag-bg text-tag-text dark:bg-tag-bg-dark dark:text-tag-text-dark rounded-full px-3 py-1 text-xs font-medium">
                                {tag}
                            </span>
                        ))}
                    </div>
                )
            }
        </header>

        <div class="mdx-content prose prose-lg mx-auto max-w-3xl dark:prose-invert">
            <slot />
        </div>
    </article>

    <HeadingLinks />
</PageLayout>
