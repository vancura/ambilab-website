---
import '@/styles/mdx-content.css';

import { localeToIntl } from '@i18n/config';
import { getTranslation } from '@i18n/translations';
import { calculateReadingTime } from '@i18n/utils';
import type { Locale } from '@type/locale';
import type { ISEOMetadata } from '@type/seo';

import HeadingLinks from './HeadingLinks.astro';
import PageLayout from './PageLayout.astro';

export interface Props extends ISEOMetadata {
    locale: Locale;
    title: string;
    pubDate: Date;
    updatedDate?: Date;
    author: string;
    tags?: string[];
    content: string;
    translationPath?: string;
}

const { locale, title, pubDate, updatedDate, author, tags = [], content, translationPath, ...seoProps } = Astro.props;
const t = getTranslation(locale);
const readingTime = calculateReadingTime(content);

const formatDate = (date: Date) => {
    return new Intl.DateTimeFormat(localeToIntl[locale], {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
    }).format(date);
};
---

<PageLayout locale={locale} title={title} {...translationPath ? { translationPath } : {}} {...seoProps}>
    <article class="container mx-auto px-4 py-12">
        <header class="mb-12">
            <h1 class="mb-4 text-4xl font-bold md:text-5xl">{title}</h1>

            <div class="flex flex-wrap items-center gap-4 text-sm text-gray-600 dark:text-gray-400">
                <div class="flex items-center gap-2">
                    <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path
                            d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
                        ></path>
                    </svg>
                    <span>{author}</span>
                </div>

                <div class="flex items-center gap-2">
                    <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path
                            d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V9h14v10z"
                        ></path>
                    </svg>
                    <time datetime={pubDate.toISOString()}>
                        {t.blog.publishedOn}
                        {formatDate(pubDate)}
                    </time>
                </div>

                {
                    updatedDate && (
                        <div class="flex items-center gap-2">
                            <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z" />
                            </svg>
                            <time datetime={updatedDate.toISOString()}>
                                {t.blog.updatedOn} {formatDate(updatedDate)}
                            </time>
                        </div>
                    )
                }

                <div class="flex items-center gap-2">
                    <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path
                            d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.2 3.2.8-1.3-4.5-2.7V7z"
                        ></path>
                    </svg>
                    <span>
                        {readingTime}
                        {t.blog.minutesShort}
                    </span>
                </div>
            </div>

            {
                tags.length > 0 && (
                    <div class="mt-4 flex flex-wrap items-center gap-2">
                        <svg
                            class="h-4 w-4 text-gray-600 dark:text-gray-400"
                            fill="currentColor"
                            viewBox="0 0 24 24"
                            aria-hidden="true"
                        >
                            <path d="M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z" />
                        </svg>
                        {tags.map((tag) => (
                            <span class="rounded-full bg-blue-100 px-3 py-1 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-200">
                                {tag}
                            </span>
                        ))}
                    </div>
                )
            }
        </header>

        <div class="mdx-content prose prose-lg mx-auto max-w-3xl dark:prose-invert">
            <slot />
        </div>
    </article>

    <HeadingLinks />
</PageLayout>
