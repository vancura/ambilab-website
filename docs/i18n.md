# Internationalization

The Ambilab website supports English and Czech with domain-based locale detection and cookie override.

## Supported Locales

| Locale Code | Language | Domain      |
| ----------- | -------- | ----------- |
| `en`        | English  | ambilab.com |
| `cs`        | Czech    | ambilab.cz  |

## Locale Detection

The locale is determined using the following priority order:

1. **Cookie override** - `locale` cookie set by user preference
2. **Domain detection** - Based on request hostname
3. **Default fallback** – English (`en`)

### Domain Mapping

| Hostname      | Detected Locale |
| ------------- | --------------- |
| `ambilab.com` | `en`            |
| `ambilab.cz`  | `cs`            |
| `localhost`   | `en` (default)  |
| Other         | `en` (default)  |

## Testing Locally

To test Czech locale detection locally, add to `/etc/hosts`:

```bash
127.0.0.1 ambilab.cz
```

Then access `http://ambilab.cz:4321` during development.

Alternatively, use the locale switcher component or set the `locale` cookie manually in browser DevTools.

## Content Translation

### Linking Translations

Link translated content using the `translationSlug` frontmatter field:

**English post** (`src/content/blog/en/hello-world.mdx`):

```yaml
---
title: 'Hello World'
description: 'My first blog post'
locale: 'en'
translationSlug: 'ahoj-svete'
pubDate: 2024-01-15
author: 'Ambilab'
tags: ['announcement']
---
```

**Czech translation** (`src/content/blog/cs/ahoj-svete.mdx`):

```yaml
---
title: 'Ahoj svete'
description: 'Muj prvni clanek'
locale: 'cs'
translationSlug: 'hello-world'
pubDate: 2024-01-15
author: 'Ambilab'
tags: ['oznameni']
---
```

The `translationSlug` must match the filename (without extension) of the translated version.

### Creating Bilingual Content

1. Create content file in `src/content/blog/en/` or `src/content/blog/cs/`
2. Add required frontmatter fields including `locale`
3. Set `translationSlug` to link to the translation
4. Create the corresponding translation file

See [Content Management](content.md) for detailed content creation guides.

## UI Translations

All user-facing strings are defined in [`src/i18n/translations.ts`](../src/i18n/translations.ts).

### Translation Structure

```typescript
export interface Translations {
  nav: {
    home: string;
    about: string;
    blog: string;
  };
  buttons: {
    readMore: string;
    subscribe: string;
    // ...
  };
  footer: {
    copyright: string;
    // ...
  };
  // ... other sections
}
```

### Using Translations

```astro
---
import { getTranslation } from '@i18n/translations';

const { locale } = Astro.locals;
const t = getTranslation(locale);
---

<nav>
  <a href="/">{t.nav.home}</a>
  <a href="/about">{t.nav.about}</a>
  <a href="/blog">{t.nav.blog}</a>
</nav>
```

In Svelte components:

```svelte
<script lang="ts">
  import { getTranslation } from '@i18n/translations';
  import type { Locale } from '@type/locale';

  interface Props {
    locale: Locale;
  }

  let { locale }: Props = $props();
  const t = getTranslation(locale);
</script>

<button>{t.buttons.subscribe}</button>
```

### Adding New Translations

1. Add the key to the `Translations` interface in `src/i18n/translations.ts`
2. Add translations for both `en` and `cs` in the `translations` object
3. Use via `getTranslation(locale).section.key`

## Locale Utilities

**Location**: [`src/i18n/utils.ts`](../src/i18n/utils.ts)

### detectLocaleFromUrl

Detect the locale from the URL hostname.

```typescript
import { detectLocaleFromUrl } from '@i18n/utils';

const url = new URL(request.url);
const locale = detectLocaleFromUrl(url);
// Returns: 'en' | 'cs'
```

### getLocaleFromCookie

Get locale from request cookie.

```typescript
import { getLocaleFromCookie } from '@i18n/utils';

const locale = getLocaleFromCookie(request);
// Returns: 'en' | 'cs' | null
```

### setLocaleCookie

Set a locale preference cookie (client-side only).

```typescript
import { setLocaleCookie } from '@i18n/utils';

setLocaleCookie('cs');
// Sets cookie: locale=cs; path=/; max-age=31536000
```

### getLocalizedPath

Generate the localized URL path.

```typescript
import { getLocalizedPath } from '@i18n/utils';

const enPath = getLocalizedPath('/about', 'en');
const csPath = getLocalizedPath('/about', 'cs');
```

### calculateReadingTime

Estimate reading time for blog posts (200 words per minute).

```typescript
import { calculateReadingTime } from '@i18n/utils';

const minutes = calculateReadingTime(postContent);
// Returns: number
```

## Locale Configuration

**Location**: [`src/i18n/config.ts`](../src/i18n/config.ts)

```typescript
export const DEFAULT_LOCALE: Locale = 'en';

export const LOCALE_CONFIGS: Record<Locale, LocaleConfig> = {
  en: { code: 'en', name: 'English' },
  cs: { code: 'cs', name: 'Cestina' },
};
```

## Locale Switcher Component

The [`LocaleSwitcher`](../src/components/svelte/LocaleSwitcher.svelte) component allows users to switch between locales:

```astro
---
import LocaleSwitcher from '@components/svelte/LocaleSwitcher.svelte';
---

<LocaleSwitcher currentLocale={locale} translationPath="/cs/about" client:load />
```

**Props:**

- `currentLocale` - Current page locale
- `translationPath` - Path to the translated version (optional)

When clicked, the component:

1. Sets the locale cookie
2. Navigates to the translation path (or the same path if no translation)
3. Uses View Transitions for smooth navigation

## RSS Feeds

Locale-specific RSS feeds are generated at:

- **English**: `/en/rss.xml`
- **Czech**: `/cs/rss.xml`

Each feed contains only posts in that locale.

## Related Documentation

- [Content Management](content.md) – Creating bilingual content
- [Utilities](utilities.md) - i18n utility functions
- [Components](components.md) - LocaleSwitcher component details
